import type { CharacterClass, SpellSlotProgression, ClassFeature } from '@/types'

// Spell slot progression tables
const fullCasterSlots: SpellSlotProgression = {
  1: [2, 0, 0, 0, 0, 0, 0, 0, 0],
  2: [3, 0, 0, 0, 0, 0, 0, 0, 0],
  3: [4, 2, 0, 0, 0, 0, 0, 0, 0],
  4: [4, 3, 0, 0, 0, 0, 0, 0, 0],
  5: [4, 3, 2, 0, 0, 0, 0, 0, 0],
  6: [4, 3, 3, 0, 0, 0, 0, 0, 0],
  7: [4, 3, 3, 1, 0, 0, 0, 0, 0],
  8: [4, 3, 3, 2, 0, 0, 0, 0, 0],
  9: [4, 3, 3, 3, 1, 0, 0, 0, 0],
  10: [4, 3, 3, 3, 2, 0, 0, 0, 0],
  11: [4, 3, 3, 3, 2, 1, 0, 0, 0],
  12: [4, 3, 3, 3, 2, 1, 0, 0, 0],
  13: [4, 3, 3, 3, 2, 1, 1, 0, 0],
  14: [4, 3, 3, 3, 2, 1, 1, 0, 0],
  15: [4, 3, 3, 3, 2, 1, 1, 1, 0],
  16: [4, 3, 3, 3, 2, 1, 1, 1, 0],
  17: [4, 3, 3, 3, 2, 1, 1, 1, 1],
  18: [4, 3, 3, 3, 3, 1, 1, 1, 1],
  19: [4, 3, 3, 3, 3, 2, 1, 1, 1],
  20: [4, 3, 3, 3, 3, 2, 2, 1, 1],
}

const halfCasterSlots: SpellSlotProgression = {
  1: [0, 0, 0, 0, 0, 0, 0, 0, 0],
  2: [2, 0, 0, 0, 0, 0, 0, 0, 0],
  3: [3, 0, 0, 0, 0, 0, 0, 0, 0],
  4: [3, 0, 0, 0, 0, 0, 0, 0, 0],
  5: [4, 2, 0, 0, 0, 0, 0, 0, 0],
  6: [4, 2, 0, 0, 0, 0, 0, 0, 0],
  7: [4, 3, 0, 0, 0, 0, 0, 0, 0],
  8: [4, 3, 0, 0, 0, 0, 0, 0, 0],
  9: [4, 3, 2, 0, 0, 0, 0, 0, 0],
  10: [4, 3, 2, 0, 0, 0, 0, 0, 0],
  11: [4, 3, 3, 0, 0, 0, 0, 0, 0],
  12: [4, 3, 3, 0, 0, 0, 0, 0, 0],
  13: [4, 3, 3, 1, 0, 0, 0, 0, 0],
  14: [4, 3, 3, 1, 0, 0, 0, 0, 0],
  15: [4, 3, 3, 2, 0, 0, 0, 0, 0],
  16: [4, 3, 3, 2, 0, 0, 0, 0, 0],
  17: [4, 3, 3, 3, 1, 0, 0, 0, 0],
  18: [4, 3, 3, 3, 1, 0, 0, 0, 0],
  19: [4, 3, 3, 3, 2, 0, 0, 0, 0],
  20: [4, 3, 3, 3, 2, 0, 0, 0, 0],
}

export const classes: CharacterClass[] = [
  // FIGHTER
  {
    id: 'fighter',
    name: 'Fighter',
    hitDie: 10,
    primaryAbility: ['strength', 'dexterity'],
    savingThrowProficiencies: ['strength', 'constitution'],
    armorProficiencies: ['light', 'medium', 'heavy', 'shields'],
    weaponProficiencies: ['simple', 'martial'],
    skillChoices: {
      count: 2,
      options: ['Acrobatics', 'Animal Handling', 'Athletics', 'History', 'Insight', 'Intimidation', 'Perception', 'Survival'],
    },
    features: [
      {
        id: 'weapon-mastery-fighter',
        type: 'weapon_mastery',
        name: 'Weapon Mastery',
        level: 1,
        description: 'You can use the mastery property of weapons you are proficient with. Choose 3 weapons to master (increases at levels 4, 10, and 16).',
        trigger: 'passive',
        masteredWeaponCount: 3,
        masteredWeaponCountAtLevels: { 4: 4, 10: 5, 16: 6 },
      },
      {
        id: 'fighting-style-fighter',
        type: 'fighting_style',
        name: 'Fighting Style',
        level: 1,
        description: 'You adopt a particular style of fighting as your specialty.',
        trigger: 'passive',
        availableStyles: ['archery', 'defense', 'dueling', 'great_weapon', 'protection', 'two_weapon'],
      },
      {
        id: 'second-wind',
        type: 'second_wind',
        name: 'Second Wind',
        level: 1,
        description: 'Bonus action: regain 1d10 + fighter level HP.',
        trigger: 'bonus_action',
        healDice: '1d10',
        healBonusPerLevel: true,
        maxUses: 2,
        maxUsesAtLevels: { 1: 2, 4: 3, 10: 4 },
      },
      {
        id: 'action-surge',
        type: 'action_surge',
        name: 'Action Surge',
        level: 2,
        description: 'Take one additional action on your turn. Once per combat.',
        trigger: 'action',
        maxUses: 1,
        maxUsesAtLevels: { 2: 1, 17: 2 },
      },
      {
        id: 'martial-archetype',
        type: 'generic',
        name: 'Martial Archetype',
        level: 3,
        description: 'You choose an archetype that you strive to emulate in your combat styles and techniques: Champion, Battle Master, or Eldritch Knight.',
        trigger: 'passive',
      },
      {
        id: 'asi-fighter-4',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 4,
        description: 'You can increase one ability score of your choice by 2, or you can increase two ability scores of your choice by 1.',
        trigger: 'passive',
      },
      {
        id: 'extra-attack',
        type: 'extra_attack',
        name: 'Extra Attack',
        level: 5,
        description: 'You can attack twice, instead of once, whenever you take the Attack action on your turn.',
        trigger: 'passive',
        attackCount: 2,
      },
      {
        id: 'tactical-shift',
        type: 'generic',
        name: 'Tactical Shift',
        level: 5,
        description: 'Whenever you activate your Second Wind with a Bonus Action, you can move up to half your Speed without provoking Opportunity Attacks.',
        trigger: 'passive',
      },
      {
        id: 'asi-fighter-6',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 6,
        description: 'You can increase one ability score of your choice by 2, or you can increase two ability scores of your choice by 1.',
        trigger: 'passive',
      },
      {
        id: 'asi-fighter-8',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 8,
        description: 'You can increase one ability score of your choice by 2, or you can increase two ability scores of your choice by 1.',
        trigger: 'passive',
      },
      {
        id: 'indomitable',
        type: 'indomitable',
        name: 'Indomitable',
        level: 9,
        description: 'If you fail a saving throw, you can reroll it with a bonus equal to your Fighter level. You must use the new roll.',
        trigger: 'reaction',
        maxUses: 1,
        maxUsesAtLevels: { 9: 1, 13: 2, 17: 3 },
      },
      {
        id: 'tactical-master',
        type: 'tactical_master',
        name: 'Tactical Master',
        level: 9,
        description: 'When you attack with a weapon whose mastery property you can use, you can replace that property with the Push, Sap, or Slow property for that attack.',
        trigger: 'passive',
        allowedMasteries: ['push', 'sap', 'slow'],
      },
      {
        id: 'extra-attack-2',
        type: 'extra_attack',
        name: 'Extra Attack (2)',
        level: 11,
        description: 'You can attack three times whenever you take the Attack action on your turn.',
        trigger: 'passive',
        attackCount: 3,
      },
      {
        id: 'asi-fighter-12',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 12,
        description: 'You can increase one ability score of your choice by 2, or you can increase two ability scores of your choice by 1.',
        trigger: 'passive',
      },
      {
        id: 'studied-attacks',
        type: 'studied_attacks',
        name: 'Studied Attacks',
        level: 13,
        description: 'If you miss with an attack roll, you have Advantage on your next attack roll against that target before the end of your next turn.',
        trigger: 'passive',
      },
      {
        id: 'asi-fighter-14',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 14,
        description: 'You can increase one ability score of your choice by 2, or you can increase two ability scores of your choice by 1.',
        trigger: 'passive',
      },
      {
        id: 'asi-fighter-16',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 16,
        description: 'You can increase one ability score of your choice by 2, or you can increase two ability scores of your choice by 1.',
        trigger: 'passive',
      },
      {
        id: 'asi-fighter-19',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 19,
        description: 'You can increase one ability score of your choice by 2, or you can increase two ability scores of your choice by 1.',
        trigger: 'passive',
      },
      {
        id: 'extra-attack-3',
        type: 'extra_attack',
        name: 'Extra Attack (3)',
        level: 20,
        description: 'You can attack four times whenever you take the Attack action on your turn.',
        trigger: 'passive',
        attackCount: 4,
      },
    ] as ClassFeature[],
    subclassLevel: 3,
    subclasses: [
      {
        id: 'champion',
        name: 'Champion',
        features: [
          {
            id: 'improved-critical',
            type: 'improved_critical',
            name: 'Improved Critical',
            level: 3,
            description: 'Your weapon attacks score a critical hit on a roll of 19 or 20.',
            trigger: 'passive',
            criticalRange: 19,
          },
          {
            id: 'remarkable-athlete',
            type: 'generic',
            name: 'Remarkable Athlete',
            level: 7,
            description: 'You can add half your proficiency bonus (round up) to any Strength, Dexterity, or Constitution check you make that doesn\'t already use your proficiency bonus. In addition, when you make a running long jump, the distance you can cover increases by a number of feet equal to your Strength modifier.',
            trigger: 'passive',
          },
          {
            id: 'additional-fighting-style',
            type: 'additional_fighting_style',
            name: 'Additional Fighting Style',
            level: 10,
            description: 'You can choose a second option from the Fighting Style class feature.',
            trigger: 'passive',
          },
          {
            id: 'superior-critical',
            type: 'improved_critical',
            name: 'Superior Critical',
            level: 15,
            description: 'Your weapon attacks score a critical hit on a roll of 18-20.',
            trigger: 'passive',
            criticalRange: 18,
          },
          {
            id: 'survivor',
            type: 'generic',
            name: 'Survivor',
            level: 18,
            description: 'At the start of each of your turns, you regain hit points equal to 5 + your Constitution modifier if you have no more than half of your hit points left. You don\'t gain this benefit if you have 0 hit points.',
            trigger: 'passive',
          },
        ] as ClassFeature[],
      },
      {
        id: 'battle-master',
        name: 'Battle Master',
        features: [
          {
            id: 'combat-superiority',
            type: 'combat_superiority',
            name: 'Combat Superiority',
            level: 3,
            description: 'You learn maneuvers that are fueled by special dice called superiority dice. You have four d8 superiority dice, and you regain all expended dice when you finish a short or long rest.',
            trigger: 'passive',
            superiorityDiceCount: 4,
            superiorityDieSize: 8,
            maneuversKnown: 3,
            superiorityDiceAtLevels: { 7: 5, 15: 6 },
            superiorityDieSizeAtLevels: { 10: 10, 18: 12 },
            maneuversKnownAtLevels: { 7: 5, 10: 7, 15: 9 },
          },
          {
            id: 'student-of-war',
            type: 'generic',
            name: 'Student of War',
            level: 3,
            description: 'You gain proficiency with one type of artisan\'s tools of your choice.',
            trigger: 'passive',
          },
          {
            id: 'know-your-enemy',
            type: 'generic',
            name: 'Know Your Enemy',
            level: 7,
            description: 'If you spend at least 1 minute observing or interacting with another creature outside combat, you can learn certain information about its capabilities compared to your own.',
            trigger: 'passive',
          },
          {
            id: 'relentless',
            type: 'relentless',
            name: 'Relentless',
            level: 15,
            description: 'When you roll initiative and have no superiority dice remaining, you regain one superiority die.',
            trigger: 'passive',
          },
        ] as ClassFeature[],
      },
    ],
  },

  // ROGUE
  {
    id: 'rogue',
    name: 'Rogue',
    hitDie: 8,
    primaryAbility: ['dexterity'],
    savingThrowProficiencies: ['dexterity', 'intelligence'],
    armorProficiencies: ['light'],
    weaponProficiencies: ['simple', 'hand crossbow', 'longsword', 'rapier', 'shortsword'],
    skillChoices: {
      count: 4,
      options: ['Acrobatics', 'Athletics', 'Deception', 'Insight', 'Intimidation', 'Investigation', 'Perception', 'Performance', 'Persuasion', 'Sleight of Hand', 'Stealth'],
    },
    features: [
      {
        id: 'expertise-1',
        type: 'generic',
        name: 'Expertise',
        level: 1,
        description: 'Choose two of your skill proficiencies. Your proficiency bonus is doubled for any ability check you make that uses either of the chosen proficiencies.',
        trigger: 'passive',
      },
      {
        id: 'sneak-attack',
        type: 'sneak_attack',
        name: 'Sneak Attack',
        level: 1,
        description: 'Once per turn, extra damage with finesse/ranged weapon when you have advantage or ally adjacent to target.',
        trigger: 'on_attack_roll',
        baseDice: '1d6',
        diceScaling: {
          3: '2d6', 5: '3d6', 7: '4d6', 9: '5d6',
          11: '6d6', 13: '7d6', 15: '8d6', 17: '9d6', 19: '10d6'
        },
      },
      {
        id: 'thieves-cant',
        type: 'generic',
        name: 'Thieves\' Cant',
        level: 1,
        description: 'You have learned thieves\' cant, a secret mix of dialect, jargon, and code that allows you to hide messages in seemingly normal conversation.',
        trigger: 'passive',
      },
      {
        id: 'cunning-action',
        type: 'cunning_action',
        name: 'Cunning Action',
        level: 2,
        description: 'You can take a bonus action to Dash, Disengage, or Hide.',
        trigger: 'bonus_action',
        allowedActions: ['dash', 'disengage', 'hide'],
      },
      {
        id: 'roguish-archetype',
        type: 'generic',
        name: 'Roguish Archetype',
        level: 3,
        description: 'You choose an archetype: Thief, Assassin, or Arcane Trickster.',
        trigger: 'passive',
      },
      {
        id: 'asi-rogue-4',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 4,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'uncanny-dodge',
        type: 'generic',
        name: 'Uncanny Dodge',
        level: 5,
        description: 'When hit by an attack you can see, use your reaction to halve the damage.',
        trigger: 'reaction',
      },
      {
        id: 'expertise-2',
        type: 'generic',
        name: 'Expertise',
        level: 6,
        description: 'Choose two more skill proficiencies for Expertise.',
        trigger: 'passive',
      },
      {
        id: 'evasion',
        type: 'generic',
        name: 'Evasion',
        level: 7,
        description: 'Take no damage on successful DEX save, half on failure.',
        trigger: 'passive',
      },
      {
        id: 'asi-rogue-8',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 8,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'asi-rogue-10',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 10,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'reliable-talent',
        type: 'generic',
        name: 'Reliable Talent',
        level: 11,
        description: 'Treat any d20 roll of 9 or lower as a 10 for proficient ability checks.',
        trigger: 'passive',
      },
      {
        id: 'asi-rogue-12',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 12,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'blindsense',
        type: 'generic',
        name: 'Blindsense',
        level: 14,
        description: 'Aware of hidden/invisible creatures within 10 feet if you can hear.',
        trigger: 'passive',
      },
      {
        id: 'slippery-mind',
        type: 'generic',
        name: 'Slippery Mind',
        level: 15,
        description: 'You gain proficiency in Wisdom saving throws.',
        trigger: 'passive',
      },
      {
        id: 'asi-rogue-16',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 16,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'elusive',
        type: 'generic',
        name: 'Elusive',
        level: 18,
        description: 'No attack roll has advantage against you while you aren\'t incapacitated.',
        trigger: 'passive',
      },
      {
        id: 'asi-rogue-19',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 19,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'stroke-of-luck',
        type: 'generic',
        name: 'Stroke of Luck',
        level: 20,
        description: 'Turn a miss into a hit, or treat a failed ability check as a 20. Once per combat.',
        trigger: 'passive',
        maxUses: 1,
      },
    ] as ClassFeature[],
    subclassLevel: 3,
    subclasses: [
      {
        id: 'thief',
        name: 'Thief',
        features: [
          {
            id: 'fast-hands',
            type: 'generic',
            name: 'Fast Hands',
            level: 3,
            description: 'You can use the bonus action granted by your Cunning Action to make a Dexterity (Sleight of Hand) check, use your thieves\' tools to disarm a trap or open a lock, or take the Use an Object action.',
            trigger: 'bonus_action',
          },
          {
            id: 'second-story-work',
            type: 'generic',
            name: 'Second-Story Work',
            level: 3,
            description: 'You gain the ability to climb faster than normal; climbing no longer costs you extra movement. In addition, when you make a running jump, the distance you cover increases by a number of feet equal to your Dexterity modifier.',
            trigger: 'passive',
          },
          {
            id: 'supreme-sneak',
            type: 'generic',
            name: 'Supreme Sneak',
            level: 9,
            description: 'You have advantage on a Dexterity (Stealth) check if you move no more than half your speed on the same turn.',
            trigger: 'passive',
          },
          {
            id: 'use-magic-device',
            type: 'generic',
            name: 'Use Magic Device',
            level: 13,
            description: 'You have learned enough about the workings of magic that you can improvise the use of items even when they are not intended for you. You ignore all class, race, and level requirements on the use of magic items.',
            trigger: 'passive',
          },
          {
            id: 'thiefs-reflexes',
            type: 'generic',
            name: 'Thief\'s Reflexes',
            level: 17,
            description: 'You can take two turns during the first round of any combat. You take your first turn at your normal initiative and your second turn at your initiative minus 10.',
            trigger: 'passive',
          },
        ] as ClassFeature[],
      },
      {
        id: 'assassin',
        name: 'Assassin',
        features: [
          {
            id: 'bonus-proficiencies-assassin',
            type: 'generic',
            name: 'Bonus Proficiencies',
            level: 3,
            description: 'You gain proficiency with the disguise kit and the poisoner\'s kit.',
            trigger: 'passive',
          },
          {
            id: 'assassinate',
            type: 'generic',
            name: 'Assassinate',
            level: 3,
            description: 'You have advantage on attack rolls against any creature that hasn\'t taken a turn in the combat yet. In addition, any hit you score against a creature that is surprised is a critical hit.',
            trigger: 'on_attack_roll',
          },
          {
            id: 'infiltration-expertise',
            type: 'generic',
            name: 'Infiltration Expertise',
            level: 9,
            description: 'You can unfailingly create false identities for yourself. You must spend seven days and 25 gp to establish the history, profession, and affiliations for an identity.',
            trigger: 'passive',
          },
          {
            id: 'impostor',
            type: 'generic',
            name: 'Impostor',
            level: 13,
            description: 'You gain the ability to unerringly mimic another person\'s speech, writing, and behavior.',
            trigger: 'passive',
          },
          {
            id: 'death-strike',
            type: 'generic',
            name: 'Death Strike',
            level: 17,
            description: 'When you attack and hit a creature that is surprised, it must make a Constitution saving throw (DC 8 + your Dexterity modifier + your proficiency bonus). On a failed save, double the damage of your attack against the creature.',
            trigger: 'on_attack_roll',
          },
        ] as ClassFeature[],
      },
    ],
  },

  // WIZARD
  {
    id: 'wizard',
    name: 'Wizard',
    hitDie: 6,
    primaryAbility: ['intelligence'],
    savingThrowProficiencies: ['intelligence', 'wisdom'],
    armorProficiencies: [],
    weaponProficiencies: ['dagger', 'dart', 'sling', 'quarterstaff', 'light crossbow'],
    skillChoices: {
      count: 2,
      options: ['Arcana', 'History', 'Insight', 'Investigation', 'Medicine', 'Religion'],
    },
    features: [
      {
        id: 'spellcasting-wizard',
        type: 'generic',
        name: 'Spellcasting',
        level: 1,
        description: 'Intelligence is your spellcasting ability. Prepare spells equal to INT modifier + wizard level.',
        trigger: 'passive',
      },
      {
        id: 'arcane-recovery',
        type: 'generic',
        name: 'Arcane Recovery',
        level: 1,
        description: 'Recover expended spell slots equal to half your wizard level (rounded up) once per combat.',
        trigger: 'passive',
      },
      {
        id: 'arcane-tradition',
        type: 'generic',
        name: 'Arcane Tradition',
        level: 2,
        description: 'Choose an arcane tradition: Evocation, Abjuration, or another school.',
        trigger: 'passive',
      },
      {
        id: 'asi-wizard-4',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 4,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'asi-wizard-8',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 8,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'asi-wizard-12',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 12,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'asi-wizard-16',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 16,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'spell-mastery',
        type: 'generic',
        name: 'Spell Mastery',
        level: 18,
        description: 'Cast one 1st and one 2nd level spell at will without expending slots.',
        trigger: 'passive',
      },
      {
        id: 'asi-wizard-19',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 19,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'signature-spells',
        type: 'generic',
        name: 'Signature Spells',
        level: 20,
        description: 'Two 3rd-level spells always prepared and castable once without slots.',
        trigger: 'passive',
      },
    ] as ClassFeature[],
    subclassLevel: 2,
    subclasses: [
      {
        id: 'evocation',
        name: 'School of Evocation',
        features: [
          {
            id: 'evocation-savant',
            type: 'generic',
            name: 'Evocation Savant',
            level: 2,
            description: 'The gold and time you must spend to copy an evocation spell into your spellbook is halved.',
            trigger: 'passive',
          },
          {
            id: 'sculpt-spells',
            type: 'generic',
            name: 'Sculpt Spells',
            level: 2,
            description: 'When you cast an evocation spell that affects other creatures that you can see, you can choose a number of them equal to 1 + the spell\'s level. The chosen creatures automatically succeed on their saving throws against the spell, and they take no damage if they would normally take half damage on a successful save.',
            trigger: 'passive',
          },
          {
            id: 'potent-cantrip',
            type: 'generic',
            name: 'Potent Cantrip',
            level: 6,
            description: 'Your damaging cantrips affect even creatures that avoid the brunt of the effect. When a creature succeeds on a saving throw against your cantrip, the creature takes half the cantrip\'s damage (if any) but suffers no additional effect from the cantrip.',
            trigger: 'passive',
          },
          {
            id: 'empowered-evocation',
            type: 'generic',
            name: 'Empowered Evocation',
            level: 10,
            description: 'You can add your Intelligence modifier to one damage roll of any wizard evocation spell you cast.',
            trigger: 'on_damage_roll',
          },
          {
            id: 'overchannel',
            type: 'generic',
            name: 'Overchannel',
            level: 14,
            description: 'When you cast a wizard spell of 1st through 5th level that deals damage, you can deal maximum damage with that spell. The first time you do so, you suffer no adverse effect. If you use this feature again before you finish a long rest, you take 2d12 necrotic damage for each level of the spell, immediately after you cast it.',
            trigger: 'on_damage_roll',
          },
        ] as ClassFeature[],
      },
      {
        id: 'abjuration',
        name: 'School of Abjuration',
        features: [
          {
            id: 'abjuration-savant',
            type: 'generic',
            name: 'Abjuration Savant',
            level: 2,
            description: 'The gold and time you must spend to copy an abjuration spell into your spellbook is halved.',
            trigger: 'passive',
          },
          {
            id: 'arcane-ward',
            type: 'generic',
            name: 'Arcane Ward',
            level: 2,
            description: 'When you cast an abjuration spell of 1st level or higher, you can simultaneously use a strand of the spell\'s magic to create a magical ward on yourself that lasts until you finish a long rest. The ward has hit points equal to twice your wizard level + your Intelligence modifier. Whenever you take damage, the ward takes the damage instead.',
            trigger: 'passive',
          },
          {
            id: 'projected-ward',
            type: 'generic',
            name: 'Projected Ward',
            level: 6,
            description: 'When a creature that you can see within 30 feet of you takes damage, you can use your reaction to cause your Arcane Ward to absorb that damage.',
            trigger: 'reaction',
          },
          {
            id: 'improved-abjuration',
            type: 'generic',
            name: 'Improved Abjuration',
            level: 10,
            description: 'When you cast an abjuration spell that requires you to make an ability check as a part of casting that spell (as in counterspell and dispel magic), you add your proficiency bonus to that ability check.',
            trigger: 'passive',
          },
          {
            id: 'spell-resistance',
            type: 'generic',
            name: 'Spell Resistance',
            level: 14,
            description: 'You have advantage on saving throws against spells. Furthermore, you have resistance against the damage of spells.',
            trigger: 'passive',
          },
        ] as ClassFeature[],
      },
    ],
    spellcasting: {
      ability: 'intelligence',
      cantripsKnownProgression: [3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
      spellSlotProgression: fullCasterSlots,
      preparedCaster: true,
      ritual: true,
    },
  },

  // CLERIC
  {
    id: 'cleric',
    name: 'Cleric',
    hitDie: 8,
    primaryAbility: ['wisdom'],
    savingThrowProficiencies: ['wisdom', 'charisma'],
    armorProficiencies: ['light', 'medium', 'shields'],
    weaponProficiencies: ['simple'],
    skillChoices: {
      count: 2,
      options: ['History', 'Insight', 'Medicine', 'Persuasion', 'Religion'],
    },
    features: [
      {
        id: 'spellcasting-cleric',
        type: 'generic',
        name: 'Spellcasting',
        level: 1,
        description: 'Wisdom is your spellcasting ability. Prepare spells equal to WIS modifier + cleric level.',
        trigger: 'passive',
      },
      {
        id: 'divine-domain',
        type: 'generic',
        name: 'Divine Domain',
        level: 1,
        description: 'Choose a domain: Life, Light, or another. Grants domain spells and features.',
        trigger: 'passive',
      },
      {
        id: 'channel-divinity',
        type: 'generic',
        name: 'Channel Divinity',
        level: 2,
        description: 'Channel divine energy for magical effects. Turn Undead plus domain effect.',
        trigger: 'action',
        maxUses: 1,
      },
      {
        id: 'turn-undead',
        type: 'generic',
        name: 'Turn Undead',
        level: 2,
        description: 'Undead within 30ft must make WIS save or be turned for 1 minute.',
        trigger: 'action',
      },
      {
        id: 'asi-cleric-4',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 4,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'destroy-undead-1',
        type: 'generic',
        name: 'Destroy Undead (CR 1/2)',
        level: 5,
        description: 'Turned undead CR 1/2 or lower are instantly destroyed.',
        trigger: 'passive',
      },
      {
        id: 'channel-divinity-2',
        type: 'generic',
        name: 'Channel Divinity (2/rest)',
        level: 6,
        description: 'You can use Channel Divinity twice per combat.',
        trigger: 'passive',
      },
      {
        id: 'asi-cleric-8',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 8,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'destroy-undead-2',
        type: 'generic',
        name: 'Destroy Undead (CR 1)',
        level: 8,
        description: 'Turned undead CR 1 or lower are instantly destroyed.',
        trigger: 'passive',
      },
      {
        id: 'divine-intervention',
        type: 'generic',
        name: 'Divine Intervention',
        level: 10,
        description: 'Call on your deity. Roll d100; success if roll <= cleric level.',
        trigger: 'action',
      },
      {
        id: 'destroy-undead-3',
        type: 'generic',
        name: 'Destroy Undead (CR 2)',
        level: 11,
        description: 'Turned undead CR 2 or lower are instantly destroyed.',
        trigger: 'passive',
      },
      {
        id: 'asi-cleric-12',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 12,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'destroy-undead-4',
        type: 'generic',
        name: 'Destroy Undead (CR 3)',
        level: 14,
        description: 'Turned undead CR 3 or lower are instantly destroyed.',
        trigger: 'passive',
      },
      {
        id: 'asi-cleric-16',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 16,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'destroy-undead-5',
        type: 'generic',
        name: 'Destroy Undead (CR 4)',
        level: 17,
        description: 'Turned undead CR 4 or lower are instantly destroyed.',
        trigger: 'passive',
      },
      {
        id: 'channel-divinity-3',
        type: 'generic',
        name: 'Channel Divinity (3/rest)',
        level: 18,
        description: 'You can use Channel Divinity three times per combat.',
        trigger: 'passive',
      },
      {
        id: 'asi-cleric-19',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 19,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'divine-intervention-improved',
        type: 'generic',
        name: 'Divine Intervention Improvement',
        level: 20,
        description: 'Divine intervention succeeds automatically.',
        trigger: 'passive',
      },
    ] as ClassFeature[],
    subclassLevel: 1,
    subclasses: [
      {
        id: 'life',
        name: 'Life Domain',
        features: [
          {
            id: 'bonus-proficiency-life',
            type: 'generic',
            name: 'Bonus Proficiency',
            level: 1,
            description: 'You gain proficiency with heavy armor.',
            trigger: 'passive',
          },
          {
            id: 'disciple-of-life',
            type: 'generic',
            name: 'Disciple of Life',
            level: 1,
            description: 'Your healing spells are more effective. Whenever you use a spell of 1st level or higher to restore hit points to a creature, the creature regains additional hit points equal to 2 + the spell\'s level.',
            trigger: 'passive',
          },
          {
            id: 'channel-divinity-preserve-life',
            type: 'generic',
            name: 'Channel Divinity: Preserve Life',
            level: 2,
            description: 'You can use your Channel Divinity to heal the badly injured. As an action, you present your holy symbol and evoke healing energy that can restore a number of hit points equal to five times your cleric level. Choose any creatures within 30 feet of you, and divide those hit points among them.',
            trigger: 'action',
          },
          {
            id: 'blessed-healer',
            type: 'generic',
            name: 'Blessed Healer',
            level: 6,
            description: 'The healing spells you cast on others heal you as well. When you cast a spell of 1st level or higher that restores hit points to a creature other than you, you regain hit points equal to 2 + the spell\'s level.',
            trigger: 'passive',
          },
          {
            id: 'divine-strike-life',
            type: 'generic',
            name: 'Divine Strike',
            level: 8,
            description: 'You gain the ability to infuse your weapon strikes with divine energy. Once on each of your turns when you hit a creature with a weapon attack, you can cause the attack to deal an extra 1d8 radiant damage to the target. When you reach 14th level, the extra damage increases to 2d8.',
            trigger: 'on_damage_roll',
          },
          {
            id: 'supreme-healing',
            type: 'generic',
            name: 'Supreme Healing',
            level: 17,
            description: 'When you would normally roll one or more dice to restore hit points with a spell, you instead use the highest number possible for each die.',
            trigger: 'passive',
          },
        ] as ClassFeature[],
      },
      {
        id: 'light',
        name: 'Light Domain',
        features: [
          {
            id: 'bonus-cantrip-light',
            type: 'generic',
            name: 'Bonus Cantrip',
            level: 1,
            description: 'You gain the light cantrip if you don\'t already know it.',
            trigger: 'passive',
          },
          {
            id: 'warding-flare',
            type: 'generic',
            name: 'Warding Flare',
            level: 1,
            description: 'When you are attacked by a creature within 30 feet of you that you can see, you can use your reaction to impose disadvantage on the attack roll. You can use this feature a number of times equal to your Wisdom modifier (minimum once). You regain all expended uses when you finish a long rest.',
            trigger: 'reaction',
          },
          {
            id: 'channel-divinity-radiance-of-the-dawn',
            type: 'generic',
            name: 'Channel Divinity: Radiance of the Dawn',
            level: 2,
            description: 'You can use your Channel Divinity to harness sunlight, banishing darkness and dealing radiant damage to your foes. As an action, you present your holy symbol, and any magical darkness within 30 feet of you is dispelled. Additionally, each hostile creature within 30 feet must make a Constitution saving throw, taking 2d10 + your cleric level radiant damage on a failed save, or half as much on a success.',
            trigger: 'action',
          },
          {
            id: 'improved-flare',
            type: 'generic',
            name: 'Improved Flare',
            level: 6,
            description: 'You can use your Warding Flare feature when a creature that you can see within 30 feet of you attacks a creature other than you.',
            trigger: 'passive',
          },
          {
            id: 'potent-spellcasting-light',
            type: 'generic',
            name: 'Potent Spellcasting',
            level: 8,
            description: 'You add your Wisdom modifier to the damage you deal with any cleric cantrip.',
            trigger: 'on_damage_roll',
          },
          {
            id: 'corona-of-light',
            type: 'generic',
            name: 'Corona of Light',
            level: 17,
            description: 'You can use your action to activate an aura of sunlight that lasts for 1 minute. You emit bright light in a 60-foot radius and dim light 30 feet beyond that. Your enemies in the bright light have disadvantage on saving throws against any spell that deals fire or radiant damage.',
            trigger: 'action',
          },
        ] as ClassFeature[],
      },
    ],
    spellcasting: {
      ability: 'wisdom',
      cantripsKnownProgression: [3, 3, 3, 4, 4, 4, 4, 4, 4, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5],
      spellSlotProgression: fullCasterSlots,
      preparedCaster: true,
      ritual: true,
    },
  },

  // RANGER (Bonus class)
  {
    id: 'ranger',
    name: 'Ranger',
    hitDie: 10,
    primaryAbility: ['dexterity', 'wisdom'],
    savingThrowProficiencies: ['strength', 'dexterity'],
    armorProficiencies: ['light', 'medium', 'shields'],
    weaponProficiencies: ['simple', 'martial'],
    skillChoices: {
      count: 3,
      options: ['Animal Handling', 'Athletics', 'Insight', 'Investigation', 'Nature', 'Perception', 'Stealth', 'Survival'],
    },
    features: [
      {
        id: 'weapon-mastery-ranger',
        type: 'weapon_mastery',
        name: 'Weapon Mastery',
        level: 1,
        description: 'You can use the mastery property of 2 weapons you are proficient with.',
        trigger: 'passive',
        masteredWeaponCount: 2,
      },
      {
        id: 'favored-enemy',
        type: 'generic',
        name: 'Favored Enemy',
        level: 1,
        description: 'Choose a type of favored enemy for tracking and combat benefits.',
        trigger: 'passive',
      },
      {
        id: 'natural-explorer',
        type: 'generic',
        name: 'Natural Explorer',
        level: 1,
        description: 'Expertise in traveling and surviving in a chosen terrain type.',
        trigger: 'passive',
      },
      {
        id: 'fighting-style-ranger',
        type: 'fighting_style',
        name: 'Fighting Style',
        level: 2,
        description: 'You adopt a particular style of fighting as your specialty.',
        trigger: 'passive',
        availableStyles: ['archery', 'defense', 'dueling', 'two_weapon'],
      },
      {
        id: 'spellcasting-ranger',
        type: 'generic',
        name: 'Spellcasting',
        level: 2,
        description: 'Wisdom is your spellcasting ability for ranger spells.',
        trigger: 'passive',
      },
      {
        id: 'ranger-archetype',
        type: 'generic',
        name: 'Ranger Archetype',
        level: 3,
        description: 'Choose an archetype: Hunter or Beast Master.',
        trigger: 'passive',
      },
      {
        id: 'primeval-awareness',
        type: 'generic',
        name: 'Primeval Awareness',
        level: 3,
        description: 'Expend a spell slot to sense nearby favored enemies.',
        trigger: 'action',
      },
      {
        id: 'asi-ranger-4',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 4,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'extra-attack-ranger',
        type: 'extra_attack',
        name: 'Extra Attack',
        level: 5,
        description: 'Attack twice when you take the Attack action.',
        trigger: 'passive',
        attackCount: 2,
      },
      {
        id: 'asi-ranger-8',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 8,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'lands-stride',
        type: 'generic',
        name: 'Land\'s Stride',
        level: 8,
        description: 'Move through difficult terrain and plants without penalty.',
        trigger: 'passive',
      },
      {
        id: 'hide-in-plain-sight',
        type: 'generic',
        name: 'Hide in Plain Sight',
        level: 10,
        description: 'Create camouflage for +10 to Stealth while remaining still.',
        trigger: 'passive',
      },
      {
        id: 'asi-ranger-12',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 12,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'vanish',
        type: 'generic',
        name: 'Vanish',
        level: 14,
        description: 'Hide as a bonus action. Can\'t be tracked by nonmagical means.',
        trigger: 'bonus_action',
      },
      {
        id: 'asi-ranger-16',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 16,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'feral-senses',
        type: 'generic',
        name: 'Feral Senses',
        level: 18,
        description: 'Fight invisible creatures without disadvantage.',
        trigger: 'passive',
      },
      {
        id: 'asi-ranger-19',
        type: 'generic',
        name: 'Ability Score Improvement',
        level: 19,
        description: 'You can increase one ability score by 2, or two ability scores by 1.',
        trigger: 'passive',
      },
      {
        id: 'foe-slayer',
        type: 'generic',
        name: 'Foe Slayer',
        level: 20,
        description: 'Add WIS modifier to attack or damage rolls against favored enemies.',
        trigger: 'passive',
      },
    ] as ClassFeature[],
    subclassLevel: 3,
    subclasses: [
      {
        id: 'hunter',
        name: 'Hunter',
        features: [
          {
            id: 'hunters-prey',
            type: 'generic',
            name: 'Hunter\'s Prey',
            level: 3,
            description: 'Choose one of the following features: Colossus Slayer (extra 1d8 damage once per turn against wounded targets), Giant Killer (reaction attack against Large or larger creatures), or Horde Breaker (attack a second creature within 5 feet).',
            trigger: 'on_attack_roll',
          },
          {
            id: 'defensive-tactics',
            type: 'generic',
            name: 'Defensive Tactics',
            level: 7,
            description: 'Choose one: Escape the Horde, Multiattack Defense, or Steel Will.',
            trigger: 'passive',
          },
          {
            id: 'multiattack-hunter',
            type: 'generic',
            name: 'Multiattack',
            level: 11,
            description: 'Choose one: Volley (ranged attack against any number of creatures within 10 feet of a point) or Whirlwind Attack (melee attack against any number of creatures within 5 feet).',
            trigger: 'action',
          },
          {
            id: 'superior-hunters-defense',
            type: 'generic',
            name: 'Superior Hunter\'s Defense',
            level: 15,
            description: 'Choose one: Evasion, Stand Against the Tide, or Uncanny Dodge.',
            trigger: 'passive',
          },
        ] as ClassFeature[],
      },
    ],
    spellcasting: {
      ability: 'wisdom',
      spellsKnownProgression: [0, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9, 9, 10, 10, 11, 11],
      cantripsKnownProgression: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
      spellSlotProgression: halfCasterSlots,
      preparedCaster: false,
      ritual: false,
    },
  },
]

export function getClassById(id: string): CharacterClass | undefined {
  return classes.find(c => c.id === id)
}

export function getAllClasses(): CharacterClass[] {
  return classes
}

export function getClassFeaturesByLevel(classData: CharacterClass, level: number) {
  return classData.features.filter(f => f.level <= level)
}

export function getSubclassFeaturesByLevel(classData: CharacterClass, subclassId: string, level: number) {
  const subclass = classData.subclasses.find(s => s.id === subclassId)
  if (!subclass) return []
  return subclass.features.filter(f => f.level <= level)
}
